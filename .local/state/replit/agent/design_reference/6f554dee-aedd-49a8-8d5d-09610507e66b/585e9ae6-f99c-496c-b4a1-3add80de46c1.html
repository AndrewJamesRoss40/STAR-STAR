<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pull-Up Tracker - Mobile Fitness App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'roboto': ['Roboto', 'sans-serif'],
                    },
                    colors: {
                        'material-blue': '#1976D2',
                        'material-blue-dark': '#1565C0',
                        'success-green': '#388E3C',
                        'accent-amber': '#FF6F00',
                    },
                    boxShadow: {
                        'material': '0 2px 4px rgba(0,0,0,0.1), 0 8px 16px rgba(0,0,0,0.1)',
                        'material-lg': '0 4px 8px rgba(0,0,0,0.12), 0 12px 24px rgba(0,0,0,0.12)',
                    }
                }
            }
        };
    </script>
</head>
<body class="font-roboto bg-gray-50 min-h-screen">
    <!-- @COMPONENT: AppHeader -->
    <header class="bg-material-blue text-white shadow-material sticky top-0 z-50">
        <div class="px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-dumbbell text-2xl"></i>
                    <h1 class="text-xl font-medium">Pull-Up Tracker</h1>
                </div>
                <button id="exportBtn" class="p-2 rounded-full hover:bg-white hover:bg-opacity-20 transition-colors">
                    <i class="fas fa-share-alt text-xl"></i>
                </button>
            </div>
        </div>
    </header>
    <!-- @END_COMPONENT: AppHeader -->

    <main class="pb-20">
        <!-- @COMPONENT: QuickStatsSection -->
        <section class="p-4 space-y-4">
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-white rounded-lg shadow-material p-4">
                    <div class="text-center">
                        <i class="fas fa-calendar-day text-material-blue text-2xl mb-2"></i>
                        <p class="text-gray-600 text-sm font-medium">Today</p>
                        <p class="text-2xl font-bold text-gray-900" data-bind="todayTotal" id="todayTotal">0</p>
                        <p class="text-xs text-gray-500">reps</p>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-material p-4">
                    <div class="text-center">
                        <i class="fas fa-calendar-week text-success-green text-2xl mb-2"></i>
                        <p class="text-gray-600 text-sm font-medium">This Week</p>
                        <p class="text-2xl font-bold text-gray-900" data-bind="weekTotal" id="weekTotal">0</p>
                        <p class="text-xs text-gray-500">reps</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow-material p-4">
                <div class="flex items-center justify-between">
                    <div>
                        <i class="fas fa-trophy text-accent-amber text-xl mb-1"></i>
                        <p class="text-gray-600 text-sm font-medium">Personal Record</p>
                        <p class="text-xl font-bold text-gray-900" data-bind="personalRecord" id="personalRecord">0</p>
                    </div>
                    <div class="text-right">
                        <p class="text-gray-600 text-sm font-medium">Total All Time</p>
                        <p class="text-xl font-bold text-gray-900" data-bind="totalReps" id="totalReps">0</p>
                    </div>
                </div>
            </div>
        </section>
        <!-- @END_COMPONENT: QuickStatsSection -->

        <!-- @COMPONENT: QuickLoggingSection -->
        <section class="p-4">
            <div class="bg-white rounded-lg shadow-material p-6">
                <h2 class="text-lg font-medium text-gray-900 mb-4 text-center">Quick Log</h2>
                
                <div class="grid grid-cols-3 gap-3 mb-6">
                    <button data-event="click:logReps(1)" class="bg-material-blue hover:bg-material-blue-dark text-white rounded-lg py-4 px-4 font-medium text-lg transition-colors shadow-md active:scale-95 transform">
                        +1
                    </button>
                    <button data-event="click:logReps(5)" class="bg-material-blue hover:bg-material-blue-dark text-white rounded-lg py-4 px-4 font-medium text-lg transition-colors shadow-md active:scale-95 transform">
                        +5
                    </button>
                    <button data-event="click:logReps(10)" class="bg-material-blue hover:bg-material-blue-dark text-white rounded-lg py-4 px-4 font-medium text-lg transition-colors shadow-md active:scale-95 transform">
                        +10
                    </button>
                </div>

                <div class="space-y-3">
                    <label class="block text-sm font-medium text-gray-700">Custom Amount</label>
                    <div class="flex space-x-3">
                        <input type="number" id="customReps" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-material-blue focus:border-transparent text-lg" placeholder="Enter reps" min="1" max="999">
                        <button data-event="click:logCustomReps" id="logCustomBtn" class="bg-success-green hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium transition-colors shadow-md active:scale-95 transform">
                            <i class="fas fa-plus mr-2"></i>Log
                        </button>
                    </div>
                </div>
            </div>
        </section>
        <!-- @END_COMPONENT: QuickLoggingSection -->

        <!-- @COMPONENT: ProgressChartSection -->
        <section class="p-4">
            <div class="bg-white rounded-lg shadow-material p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-medium text-gray-900">Progress Chart</h2>
                    <div class="flex space-x-2">
                        <button id="dailyViewBtn" class="px-3 py-1 text-sm rounded-full bg-material-blue text-white">Daily</button>
                        <button id="weeklyViewBtn" class="px-3 py-1 text-sm rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300">Weekly</button>
                    </div>
                </div>
                <div class="relative h-64">
                    <canvas id="progressChart" class="w-full h-full"></canvas>
                </div>
            </div>
        </section>
        <!-- @END_COMPONENT: ProgressChartSection -->

        <!-- @COMPONENT: RecentActivitySection -->
        <section class="p-4">
            <div class="bg-white rounded-lg shadow-material p-6">
                <h2 class="text-lg font-medium text-gray-900 mb-4">Recent Activity</h2>
                <div id="recentActivity" class="space-y-3">
                    <!-- @MAP: recentLogs.map(log => ( -->
                    <div data-mock="true" class="flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-material-blue bg-opacity-10 rounded-full flex items-center justify-center">
                                <i class="fas fa-dumbbell text-material-blue text-sm"></i>
                            </div>
                            <div>
                                <p class="font-medium text-gray-900" data-bind="log.reps">15 reps</p>
                                <p class="text-sm text-gray-500" data-bind="log.timeAgo">2 minutes ago</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-sm text-gray-500" data-bind="log.timestamp">3:45 PM</p>
                        </div>
                    </div>
                    <!-- @END_MAP )) -->
                </div>
                <button id="loadMoreBtn" class="w-full mt-4 py-2 text-material-blue hover:bg-gray-50 rounded-lg transition-colors">
                    Load More
                </button>
            </div>
        </section>
        <!-- @END_COMPONENT: RecentActivitySection -->
    </main>

    <!-- @COMPONENT: FloatingActionButton -->
    <div class="fixed bottom-6 right-6">
        <button id="fabBtn" class="w-14 h-14 bg-material-blue hover:bg-material-blue-dark text-white rounded-full shadow-material-lg flex items-center justify-center transition transform active:scale-95">
            <i class="fas fa-plus text-xl"></i>
        </button>
    </div>
    <!-- @END_COMPONENT: FloatingActionButton -->

    <!-- @COMPONENT: SuccessToast -->
    <div id="successToast" class="fixed top-20 left-4 right-4 bg-success-green text-white px-4 py-3 rounded-lg shadow-lg transform -translate-y-full opacity-0 transition-all duration-300 z-50">
        <div class="flex items-center space-x-2">
            <i class="fas fa-check-circle"></i>
            <span id="toastMessage">Logged successfully!</span>
        </div>
    </div>
    <!-- @END_COMPONENT: SuccessToast -->

    <!-- @COMPONENT: ExportModal -->
    <div id="exportModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end opacity-0 pointer-events-none transition-opacity duration-300">
        <div class="bg-white w-full rounded-t-2xl transform translate-y-full transition-transform duration-300" id="exportModalContent">
            <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-medium text-gray-900">Export Progress</h3>
                    <button id="closeExportModal" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                    <pre id="exportContent" class="text-sm text-gray-700 whitespace-pre-wrap">Loading export data...</pre>
                </div>
                <div class="flex space-x-3">
                    <button id="copyExportBtn" class="flex-1 bg-material-blue hover:bg-material-blue-dark text-white py-3 px-4 rounded-lg font-medium transition-colors">
                        <i class="fas fa-copy mr-2"></i>Copy to Clipboard
                    </button>
                    <button id="shareExportBtn" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium transition-colors">
                        <i class="fas fa-share mr-2"></i>Share
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- @END_COMPONENT: ExportModal -->

    <script>
        // @STATE: currentView:string = 'daily'
        // @STATE: todayTotal:number = 0
        // @STATE: weekTotal:number = 0
        // @STATE: personalRecord:number = 0
        // @STATE: totalReps:number = 0
        // @STATE: recentLogs:array = []
        // @STATE: chartData:object = null

        (function() {
            let currentView = 'daily';
            let chart = null;
            
            // Initialize app
            async function init() {
                await loadStats();
                await loadRecentActivity();
                initChart();
                setupEventListeners();
                
                // Auto-refresh stats every 30 seconds
                setInterval(loadStats, 30000);
            }

            // @FUNCTIONALITY: Load statistics from backend API
            async function loadStats() {
                try {
                    // TODO: Implement API call to get aggregated stats
                    const response = await fetch('/logs');
                    const logs = await response.json();
                    
                    const today = new Date().toDateString();
                    const thisWeek = getWeekStart(new Date());
                    
                    let todayTotal = 0;
                    let weekTotal = 0;
                    let totalReps = 0;
                    let personalRecord = 0;
                    
                    logs.forEach(log => {
                        const logDate = new Date(log.time);
                        const reps = parseInt(log.reps);
                        
                        totalReps += reps;
                        
                        if (logDate.toDateString() === today) {
                            todayTotal += reps;
                        }
                        
                        if (logDate >= thisWeek) {
                            weekTotal += reps;
                        }
                        
                        if (reps > personalRecord) {
                            personalRecord = reps;
                        }
                    });
                    
                    document.getElementById('todayTotal').textContent = todayTotal;
                    document.getElementById('weekTotal').textContent = weekTotal;
                    document.getElementById('personalRecord').textContent = personalRecord;
                    document.getElementById('totalReps').textContent = totalReps;
                    
                } catch (error) {
                    console.error('Error loading stats:', error);
                    showToast('Error loading statistics', 'error');
                }
            }

            // @FUNCTIONALITY: Load recent activity logs
            async function loadRecentActivity() {
                try {
                    // TODO: Implement API call to get recent logs
                    const response = await fetch('/logs');
                    const logs = await response.json();
                    
                    const recentLogs = logs.slice(-10).reverse();
                    const container = document.getElementById('recentActivity');
                    container.innerHTML = '';
                    
                    recentLogs.forEach(log => {
                        const logElement = createActivityItem(log);
                        container.appendChild(logElement);
                    });
                    
                } catch (error) {
                    console.error('Error loading recent activity:', error);
                }
            }

            // @FUNCTIONALITY: Create activity item element
            function createActivityItem(log) {
                const logTime = new Date(log.time);
                const timeAgo = getTimeAgo(logTime);
                const timeString = logTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0';
                div.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-material-blue bg-opacity-10 rounded-full flex items-center justify-center">
                            <i class="fas fa-dumbbell text-material-blue text-sm"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-900">${log.reps} reps</p>
                            <p class="text-sm text-gray-500">${timeAgo}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-gray-500">${timeString}</p>
                    </div>
                `;
                return div;
            }

            // @FUNCTIONALITY: Initialize progress chart
            function initChart() {
                const ctx = document.getElementById('progressChart').getContext('2d');
                chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Pull-ups',
                            data: [],
                            borderColor: '#1976D2',
                            backgroundColor: 'rgba(25, 118, 210, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#1976D2',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 5
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0,0,0,0.1)'
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(0,0,0,0.1)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
                
                loadChartData();
            }

            // @FUNCTIONALITY: Load chart data based on current view
            async function loadChartData() {
                try {
                    // TODO: Implement API call to get chart data
                    const response = await fetch('/logs');
                    const logs = await response.json();
                    
                    const chartData = processChartData(logs, currentView);
                    chart.data.labels = chartData.labels;
                    chart.data.datasets[0].data = chartData.data;
                    chart.update();
                    
                } catch (error) {
                    console.error('Error loading chart data:', error);
                }
            }

            // @FUNCTIONALITY: Process raw logs into chart data
            function processChartData(logs, view) {
                // TODO: Implement data processing for daily/weekly views
                const labels = [];
                const data = [];
                
                if (view === 'daily') {
                    // Group by date and sum reps
                    const dailyTotals = {};
                    logs.forEach(log => {
                        const date = new Date(log.time).toDateString();
                        dailyTotals[date] = (dailyTotals[date] || 0) + parseInt(log.reps);
                    });
                    
                    Object.entries(dailyTotals).slice(-7).forEach(([date, total]) => {
                        labels.push(new Date(date).toLocaleDateString([], { month: 'short', day: 'numeric' }));
                        data.push(total);
                    });
                } else {
                    // Weekly view - group by week
                    // Simplified implementation
                    labels.push('Week 1', 'Week 2', 'Week 3', 'Week 4');
                    data.push(45, 67, 89, 112);
                }
                
                return { labels, data };
            }

            // @FUNCTIONALITY: Log reps with haptic feedback
            async function logReps(count) {
                try {
                    // Add haptic feedback for mobile
                    if (navigator.vibrate) {
                        navigator.vibrate(50);
                    }
                    
                    // TODO: Implement API call to log reps
                    const response = await fetch('/log', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ reps: count })
                    });
                    
                    if (response.ok) {
                        showToast(`${count} reps logged!`);
                        await loadStats();
                        await loadRecentActivity();
                        await loadChartData();
                    } else {
                        throw new Error('Failed to log reps');
                    }
                    
                } catch (error) {
                    console.error('Error logging reps:', error);
                    showToast('Error logging reps', 'error');
                }
            }

            // @FUNCTIONALITY: Show success/error toast
            function showToast(message, type = 'success') {
                const toast = document.getElementById('successToast');
                const toastMessage = document.getElementById('toastMessage');
                
                toastMessage.textContent = message;
                
                if (type === 'error') {
                    toast.className = toast.className.replace('bg-success-green', 'bg-red-500');
                } else {
                    toast.className = toast.className.replace('bg-red-500', 'bg-success-green');
                }
                
                toast.style.transform = 'translateY(0)';
                toast.style.opacity = '1';
                
                setTimeout(() => {
                    toast.style.transform = 'translateY(-100%)';
                    toast.style.opacity = '0';
                }, 3000);
            }

            // @FUNCTIONALITY: Setup all event listeners
            function setupEventListeners() {
                // Quick log buttons
                document.querySelectorAll('[data-event*="logReps"]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const match = btn.getAttribute('data-event').match(/logReps\((\d+)\)/);
                        if (match) {
                            logReps(parseInt(match[1]));
                        }
                    });
                });

                // Custom reps logging
                document.getElementById('logCustomBtn').addEventListener('click', () => {
                    const input = document.getElementById('customReps');
                    const count = parseInt(input.value);
                    if (count && count > 0) {
                        logReps(count);
                        input.value = '';
                    }
                });

                // Chart view toggles
                document.getElementById('dailyViewBtn').addEventListener('click', () => {
                    currentView = 'daily';
                    updateChartViewButtons();
                    loadChartData();
                });

                document.getElementById('weeklyViewBtn').addEventListener('click', () => {
                    currentView = 'weekly';
                    updateChartViewButtons();
                    loadChartData();
                });

                // Export functionality
                document.getElementById('exportBtn').addEventListener('click', showExportModal);
                document.getElementById('closeExportModal').addEventListener('click', hideExportModal);
                document.getElementById('copyExportBtn').addEventListener('click', copyExportData);

                // FAB functionality
                document.getElementById('fabBtn').addEventListener('click', () => {
                    logReps(1);
                });

                // Enter key for custom reps
                document.getElementById('customReps').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        document.getElementById('logCustomBtn').click();
                    }
                });
            }

            // @FUNCTIONALITY: Update chart view button styles
            function updateChartViewButtons() {
                const dailyBtn = document.getElementById('dailyViewBtn');
                const weeklyBtn = document.getElementById('weeklyViewBtn');
                
                if (currentView === 'daily') {
                    dailyBtn.className = 'px-3 py-1 text-sm rounded-full bg-material-blue text-white';
                    weeklyBtn.className = 'px-3 py-1 text-sm rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300';
                } else {
                    dailyBtn.className = 'px-3 py-1 text-sm rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300';
                    weeklyBtn.className = 'px-3 py-1 text-sm rounded-full bg-material-blue text-white';
                }
            }

            // @FUNCTIONALITY: Show export modal
            async function showExportModal() {
                const modal = document.getElementById('exportModal');
                const modalContent = document.getElementById('exportModalContent');
                const exportContent = document.getElementById('exportContent');
                
                modal.style.opacity = '1';
                modal.style.pointerEvents = 'auto';
                modalContent.style.transform = 'translateY(0)';
                
                try {
                    // TODO: Implement export API call
                    const response = await fetch('/export');
                    const data = await response.json();
                    exportContent.textContent = data.export;
                } catch (error) {
                    exportContent.textContent = 'Error loading export data';
                }
            }

            // @FUNCTIONALITY: Hide export modal
            function hideExportModal() {
                const modal = document.getElementById('exportModal');
                const modalContent = document.getElementById('exportModalContent');
                
                modal.style.opacity = '0';
                modal.style.pointerEvents = 'none';
                modalContent.style.transform = 'translateY(100%)';
            }

            // @FUNCTIONALITY: Copy export data to clipboard
            async function copyExportData() {
                const exportContent = document.getElementById('exportContent');
                try {
                    await navigator.clipboard.writeText(exportContent.textContent);
                    showToast('Copied to clipboard!');
                    hideExportModal();
                } catch (error) {
                    showToast('Error copying to clipboard', 'error');
                }
            }

            // Utility functions
            function getWeekStart(date) {
                const start = new Date(date);
                const day = start.getDay();
                const diff = start.getDate() - day;
                return new Date(start.setDate(diff));
            }

            function getTimeAgo(date) {
                const now = new Date();
                const diff = now - date;
                const minutes = Math.floor(diff / 60000);
                
                if (minutes < 1) return 'Just now';
                if (minutes < 60) return `${minutes} minutes ago`;
                
                const hours = Math.floor(minutes / 60);
                if (hours < 24) return `${hours} hours ago`;
                
                const days = Math.floor(hours / 24);
                return `${days} days ago`;
            }

            // Initialize app when DOM is loaded
            document.addEventListener('DOMContentLoaded', init);
        })();
    </script>
</body>
</html>